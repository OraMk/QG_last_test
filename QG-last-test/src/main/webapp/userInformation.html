<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>个人信息</title>
    <script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js" type="text/javascript" charset="UTF-8"></script>
    <script type="text/javascript">
        function judgementBanned(){
            $.ajax({
                url:"loginServlet",
                type:"GET",
                async:true,
                data_type:'json',
                data:{"method":"judgementBanned"},
                success:function (){
                    //被封禁
                    alert("用户被封禁");
                    let url = "operation.html";
                    location.assign(url);
                },
                error:function (){
                    //没有被封禁
                }
            });
        }

        $(function (){
            $.ajax({
                url: "operationServlet",
                type: "GET",
                async: true,
                dataType: 'text',
                data: {"method": "loginUser"},
                success: function (res) {
                    setInterval(function (){
                        judgementBanned();
                    },1000);
                    $.ajax({
                        url:"loginServlet",
                        type:"GET",
                        async:true,
                        dataType:'json',
                        data:{"method":"selectByUsername"},
                        success:function (res){
                            $("#body").html("<td>"+ res.uid +"</td>\n" +
                                "            <td>"+ res.username+"</td>\n" +
                                "            <td>"+ res.name +"</td>\n" +
                                "            <td>"+ res.pnumber +"</td>\n" +
                                "            <td>"+ res.fund +"</td>\n" +
                                "            <td>"+ res.is_administrator+"</td>")
                            $("#img").html("<img src = "+ res.avatar +" width=\"250px\" />");

                            //更改头像
                            $("#check_img").click(function (){
                                // let fileInput = $("#change_img").get(0);
                                // const file = fileInput.files[0];
                                // const filePath = URL.createObjectURL(file);
                                filePath = $("#change_img").val();
                                $("#img").html("<img src = "+ filePath +" width=\"250px\" />")
                                $.ajax({
                                    url:"loginServlet",
                                    type:"GET",
                                    data:{"method":"avatarChange","avatar":filePath},
                                    async:true,
                                    success:function (){

                                    },
                                    error:function (){

                                    }
                                })
                            });
                        },
                        error: function (err){
                            alert("未登录");

                        }
                    })
                    $("#back").click(function (){
                        // 返回主界面
                        let url = "operation.html";
                        location.assign(url);
                    });


                    $("#change_information").click(function (){
                        let url = "changeUserInformation.html";
                        location.assign(url);
                    });
                    $("#change_payment").click(function (){
                        let url = "changePayment.html";
                        location.assign(url);
                    })
                },
                error: function () {
                    alert("未登录..");
                    let url = "sign.html";
                    location.assign(url);
                }
            });

        })
    </script>
</head>
<body>

<div id="img" style="position: absolute;top:180px;left: 180px">
    <img src="https://img.zcool.cn/community/01a3865ab91314a8012062e3c38ff6.png@1280w_1l_2o_100sh.png" width="250px"></img>
</div>
<div style="position: absolute;top:480px;left: 210px">
    请输入头像的url:<br>
    <input type="text" id="change_img" value="" style="width: 170px; height: 40px">
    <input type="button" id="check_img" value="更改">
</div>
<div style="width :800px;
     position: absolute;
            top: 180px;
            bottom: 0;
            left: 0;
            right: 0;
            margin: auto;">
    <table width =100% border="1px">
        <thead>
        <tr>
            <th>id</th>
            <th>用户名</th>
            <th>昵称</th>
            <th>手机号码</th>
            <th>资金</th>
            <th>封禁(yes/no)</th>

        </tr>
        </thead>
       <tbody id="body">
       </tbody>
    </table>

</div>
    <div style="position: absolute;top: 800px;left: 600px">
        <input type="button" id="change_payment" value="修改支付密码" style="width: 200px;height: 40px">
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        <input type="button" id="change_information" value="修改信息" style="width: 200px;height: 40px">
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        <input type="button" value="返回" id="back" style="width: 200px;height:40px">
    </div>
</body>
</html>