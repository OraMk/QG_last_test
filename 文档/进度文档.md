# QG资金管理系统

### 2024.4.14

#### 建表思路

建立数据库建立了四张表

enterprise 表格用来存储企业的id(系统自动分配作为主键) 企业名称，企业人数，企业规模，企业方向，公开模式，总资金,以及是否被封禁

![image-20240415101357657](img\image-20240415101357657.png)

user 表格用来储存用户的id(系统自动分配作为主键)，用户名(唯一，用户自己输入)，用户姓名，用户密码,用户的头像url(系统会分配默认头像),手机号码，个人资金，以及是否为网站管理员(默认为no)，以及是否被封禁



![image-20240415101451039](img\image-20240415101451039.png)

relation 表格 用来存储用户与企业的关系 rid(系统自动分配) 用来存储每一个唯一的关系， 存储用户id 企业id 以及 用户是否为企业群组管理员 以此可以使得用户可以同时加入多个企业而非固定一个企业，以及企业分配的企业资金

![image-20240415101524876](img\image-20240415101524876.png)

transaction 用来存储流水信息，内置一个账单id(系统自动分配),以及支付者id，收款者id(均有一个用户id和企业id)两者不能同时为空,交易时间，金额，交易描述

![image-20240415101550819](img/image-20240415101550819.png)

用户需要自己的流水账可以通过查询u_payee和u_payer的条件进行查询并获取数据发送给前端展示数据

通过以下sql语句设置联合约束用户id和企业id不能同时为空

ALTER TABLE transaction ADD CONSTRAINT CheckNotEmptyUnique CHECK (u_payer IS NOT NULL OR e_payer IS NOT NULL);

---

#### 做出了整体架构

具体知道某一部应该如何做

![资金管理系统](资金管理系统思维导图.png)

思考了转账的具体实现过程

![image-20240414163837759](img\image-20240414163837759.png)

#### 做出了登录注册功能

同时用正则表达式判断输入是否合法，同时在注册新账户时候，用ajax异步请求调用数据库查询数据判断该用户名是否存在，并在非法输入的时候无法提交表单数据，并设置了游客登录的方式，游客登录到主界面后仅仅有查询公开企业的功能 和登录功能

![image-20240415101935290](img\image-20240415101935290.png)

![image-20240415102125843](img\image-20240415102125843.png)

#### 主界面

游客登录仅有登录功能与查询公开企业功能

普通用户登录则用户查询企业以及申请加入等功能

构思：通登录界面获取的表单数据来判断是否登录以及身份信息等

目前需要是通过登录界面提交表单跳转到主界面的，主界面网页有请求体的数据，但是目前不知道如何从网页中获取请求体数据

### 2024.4.15

#### 9：30承接昨天内容主界面

在登录界面已经主界面之间的用户信息，通过设置cookie将用户信息保存到客户端，以此来记录客户是否进行登录，以及辨别其身份等信息

要模拟两个用户之间的收付款可以通过开两个浏览器登录两个账户，不同浏览器的cookie并不相通，不使用session的原因是session是保存到服务端的，且会区分浏览器，但是存在多个用户用同一个浏览器登录账户的情况，这样session便无法辨别哪个用户登录的是哪个账户，易引起混乱，因此需要使用cookie将数据保存到客户的客户端更容易辨别账户信息

#### 11：00获取用户信息

判断是否为游客，用ajax发送异步请求查找是否登录，对div的内容进行更改增添一个登录超链接以便用户登录

![image-20240415114739669](img\image-20240415114739669.png)

若为普通用户，则增添一个查看个人信息的按钮以及，退出登录按钮，退出登录由弹窗确认，防止用户误点击。但是目前展示个人信息的页面尚未做出来(退出登录是与游客登录的代码逻辑相同，若存在username的cokkie则将其值改为空字符串,使得主界面无法获取到用户信息)

![image-20240415115219017](img\image-20240415115219017.png)

![image-20240415115351075](img\image-20240415115351075.png)

#### 12:40建立用户信息查询表

发现用户资金应该存在小数位，因此将数据库中的long类型改成double类型,同时也更改了企业资金部分的内容